<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Network Settings :: Deploy Mission Critical Application Platform (MCAP)</title>
    <link rel="prev" href="section4.html">
    <link rel="next" href="../chapter4/index.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Deploy Mission Critical Application Platform (MCAP)</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/mcap-deployment/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mcap-deployment" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Deploy Mission Critical Application Platform (MCAP)</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Hands-on Lab Environment Setup for MCAP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section1.html">MCAP Setup in RHDP Lab</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section2.html">Initial Setup on Hypervisor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section3.html">Storage VM Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section4.html">Ceph Storage Deployment</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter2/index.html">Hub Cluster Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section1.html">Hub VM Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section2.html">Assisted Clusters - Hub Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section3.html">Access the Hub Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section4.html">Install Operators and Configure Service</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Infrastructure Cluster Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section1.html">Infrastructure VMs Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">Assisted Clusters - Infrastructure Clusters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">Access the Infrastructure Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section4.html">Install and Configure Operators</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section5.html">Network Settings</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter4/index.html">Tenant Cluster Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter4/section1.html">Tenant VM Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter4/section2.html">Install Sample Application on Tenant Cluster</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../appendix/appendix.html">Appendix A</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../appendix/section1.html">Initial Setup on Hypervisor without Automation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../appendix/section2.html">Storage VM Deployment without Automation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../appendix/section3.html">Hub VM Deployment without Automation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../appendix/section4.html">Infrastructure VM Deployment without Automation</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Deploy Mission Critical Application Platform (MCAP)</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Deploy Mission Critical Application Platform (MCAP)</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Deploy Mission Critical Application Platform (MCAP)</a></li>
    <li><a href="index.html">Infrastructure Cluster Deployment</a></li>
    <li><a href="section5.html">Network Settings</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Network Settings</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this section, you will be configuring additional network settings needed for deploying <em>Tenant</em> cluster.</p>
</div>
<div class="paragraph">
<p>After you install the Kubernetes NMState Operator, you can configure a Linux bridge network for live migration or external access to virtual machines (VMs).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In this POC setup, there is only one bridge, <code>virbr0</code> and each SNO VM has single NIC.
This NIC is used to deploy <em>Infrastructure</em> SNO cluster on SNO VMs.
As NIC is already used for deploying <em>Infrastructure</em> SNO cluster, NMState configuration will not work using the same NIC.</p>
</div>
<div class="paragraph">
<p>For example, two NICs are attached to SNO VMs (connected to the same bridge <code>virbr0</code>) at the time of creating SNO VMs.
In this case, deployment of <em>Infrastructure</em> cluster from <em>Hub</em> cluster using RHACM will not proceed.
The reason behind this is that the two NICs are on the same network.</p>
</div>
<div class="paragraph">
<p>Ideally, there should be separate networks for <em>Infrastructure</em> and <em>Tenant</em> clusters.
It is possible that in future releases or updates of this course, the separate network configurations may be included.</p>
</div>
<div class="paragraph">
<p>There is a workaround to address it in this POC setup, adding the second NIC to SNO VMs after the deployment of the SNO cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/MCAP_setup_2.png" alt="MCAP setup 2">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that <em>sno1</em> cluster is deployed successfully.</p>
</li>
<li>
<p>Access the <em>sno1</em> cluster via CLI and web console.</p>
</li>
<li>
<p>Ensure that <code>sno1.lab.example.com</code> node is in <code>Ready</code> status and all cluster operators are available.</p>
<div class="listingblock">
<div class="title">Sample output:</div>
<div class="content">
<pre>[root@hypervisor ~]# oc get nodes

NAME                   STATUS   ROLES                         AGE   VERSION
sno1.lab.example.com   Ready    control-plane,master,worker   23h   v1.29.7+4510e9c

[root@hypervisor ~]# oc get clusterversion

NAME      VERSION   AVAILABLE   PROGRESSING   SINCE   STATUS
version   4.16.8    True        False         23h     Cluster version is 4.16.8</pre>
</div>
</div>
</li>
<li>
<p>Ensure that NMState operator is installed on <em>sno1</em> cluster.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_add_additional_network_interface_card_nic_to_sno1_sno2_and_sno3_vms"><a class="anchor" href="#_add_additional_network_interface_card_nic_to_sno1_sno2_and_sno3_vms"></a>Add Additional Network Interface Card (NIC) to <code>sno1</code>, <code>sno2</code> and <code>sno3</code> VMs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To reduce the network complexity in POC setup, add the second NIC to SNO VMs at this point.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In <code>sno1</code> VM configuration, click <b class="button">Add hardware</b>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/sno1_add_nic.png" alt="sno1 add nic">
</div>
</div>
</li>
<li>
<p>Add network interface.</p>
<div class="paragraph">
<p>Select <span class="menuseq"><b class="menu">Network source</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Bridge device&#8230;&#8203;</b></span>.</p>
</div>
<div class="paragraph">
<p>Device name: <code>virbr0</code>.</p>
</div>
<div class="paragraph">
<p>Click <b class="button">Finish</b> to add NIC.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sno1_add_nic_1.png" alt="sno1 add nic 1">
</div>
</div>
</li>
<li>
<p>Notice, NIC is added on the fly.</p>
<div class="imageblock">
<div class="content">
<img src="_images/sno1_add_nic_2.png" alt="sno1 add nic 2">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configure_nodenetworkconfigurationpolicy"><a class="anchor" href="#_configure_nodenetworkconfigurationpolicy"></a>Configure NodeNetworkConfigurationPolicy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can create a <code>NodeNetworkConfigurationPolicy (NNCP)</code> manifest for a Linux bridge network.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access the <code>sno1</code> cluster&#8217;s web console.</p>
<div class="paragraph">
<p>From the left navigation pane, click <span class="menuseq"><b class="menu">Networking</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">NodeNetworkConfigurationPolicy</b></span>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sno1_console_nncp.png" alt="sno1 console nncp">
</div>
</div>
</li>
<li>
<p>To create the <code>NodeNetworkConfigurationPolicy (NNCP)</code>, click <span class="menuseq"><b class="menu">Create</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">From Form</b></span>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/sno1_console_nncp_1.png" alt="sno1 console nncp 1">
</div>
</div>
</li>
<li>
<p>Create the <code>NodeNetworkConfigurationPolicy (NNCP)</code>.</p>
<div class="paragraph">
<p>Policy name: <code>br0-policy</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sno1_console_nncp_2.png" alt="sno1 console nncp 2">
</div>
</div>
<div class="paragraph">
<p>Interface name: <code>br0</code>.</p>
</div>
<div class="paragraph">
<p>Type: <code>Bridge</code>.</p>
</div>
<div class="paragraph">
<p>Check box the <code>IPv4</code> and select <code>DHCP</code> in <code>IP configuration</code>.</p>
</div>
<div class="paragraph">
<p>Port: <code>enp2s0</code>.</p>
</div>
<div class="paragraph">
<p>This is the NIC, which you added in the previous section.</p>
</div>
<div class="paragraph">
<p>The NIC <code>enp2s0</code> value can be different in your environment.
Check in VM&#8217;s console from <code>virt-manager</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sno1_console_nncp_3.png" alt="sno1 console nncp 3">
</div>
</div>
<div class="paragraph">
<p>Click <b class="button">Create</b> to create the <code>NodeNetworkConfigurationPolicy (NNCP)</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sno1_console_nncp_4.png" alt="sno1 console nncp 4">
</div>
</div>
</li>
<li>
<p>Verify that the <code>Enactment states</code> of the <code>br0-policy</code> is <code>Available</code>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/sno1_console_nncp_5.png" alt="sno1 console nncp 5">
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.16/html-single/virtualization/index#virt-creating-linux-bridge-nncp_virt-post-install-network-config" target="read-later">Creating a Linux bridge NNCP</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configure_networkattachmentdefinitions"><a class="anchor" href="#_configure_networkattachmentdefinitions"></a>Configure NetworkAttachmentDefinitions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can create a <code>NetworkAttachmentDefinitions (NAD)</code> to provide layer-2 networking to pods and virtual machines by using the OpenShift Container Platform web console.</p>
</div>
<div class="paragraph">
<p>A Linux bridge network attachment definition is the most efficient method for connecting a virtual machine to a VLAN.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access the <code>sno1</code> cluster&#8217;s web console.</p>
<div class="paragraph">
<p>From the left navigation pane, click <span class="menuseq"><b class="menu">Networking</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">NetworkAttachmentDefinitions</b></span>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sno1_console_nad.png" alt="sno1 console nad">
</div>
</div>
</li>
<li>
<p>To create the <code>NetworkAttachmentDefinitions (NAD)</code>, click <b class="button">Create Network Attachment Definition</b>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/sno1_console_nad_1.png" alt="sno1 console nad 1">
</div>
</div>
</li>
<li>
<p>Create the <code>NetworkAttachmentDefinitions (NAD)</code>.</p>
<div class="paragraph">
<p>Bridge name: <code>br0</code>.</p>
</div>
<div class="paragraph">
<p>Click <b class="button">Create</b> to create the <code>NetworkAttachmentDefinitions (NAD)</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sno1_console_nad_2.png" alt="sno1 console nad 2">
</div>
</div>
</li>
<li>
<p>Verify that the <code>NetworkAttachmentDefinitions (NAD)</code> is created successfully.</p>
<div class="imageblock">
<div class="content">
<img src="_images/sno1_console_nad_3.png" alt="sno1 console nad 3">
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.16/html-single/virtualization/index#virt-creating-linux-bridge-nad-web_virt-post-install-network-config" target="read-later">Creating a Linux bridge NAD</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_network_settings_on_sno2_and_sno3_clusters"><a class="anchor" href="#_network_settings_on_sno2_and_sno3_clusters"></a>Network Settings on <code>sno2</code> and <code>sno3</code> Clusters</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the same prerequisites from the previous section for <code>sno2</code> and <code>sno3</code> clusters.</p>
</li>
<li>
<p>Follow the same steps from the previous section for configuring network settings on the <code>sno2</code> and <code>sno3</code> clusters.</p>
</li>
</ol>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="section4.html">Install and Configure Operators</a></span>
  <span class="next"><a href="../chapter4/index.html">Tenant Cluster Deployment</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
