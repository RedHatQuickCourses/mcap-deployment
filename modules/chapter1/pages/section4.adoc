= Storage VM Deployment with Automation

[NOTE]
If you choose to configure manually then skip this page and move on to next page for without automation.

In this section, you will be creating one KVM with name `storage`.

image::MCAP_setup_2.png[]

== Prerequisites

[NOTE]
If you have already followed below instructions in `Initial Setup on Hypervisor (Bare Metal) with Automation` page then skip this prerequisites.

. Download the `rhel-9.4-x86_64-kvm.qcow2` image from the https://access.redhat.com/downloads/content/rhel[Red Hat Customer Portal,window=read-later] to your laptop/desktop.

. Use secured copy (scp) to copy the `rhel-9.4-x86_64-kvm.qcow2` image from your laptop/desktop to hypervisor and then place it in `/root` directory.
+
.Sample output
----
[user@laptop]$ scp Downloads/rhel-9.4-x86_64-kvm.qcow2 lab-user@14X.XX.YY.Z:.

[user@laptop]$ ssh lab-user@14X.XX.YY.Z

[lab-user@hypervisor ~]$ sudo su -

[root@hypervisor ~]# mv /home/lab-user/rhel-9.4-x86_64-kvm.qcow2 /root/rhel-9.4-x86_64-kvm.qcow2
----

. Install `ansible-core` package on the hypervisor.
+
[source,bash,role=execute]
----
dnf install -y ansible-core
----

. Clone the repo which holds all automation scripts and ansible playbooks.
+
[source,bash,role=execute]
----
git clone <repo_link>.git
----
+
[NOTE]
##Fix the Repo##

. Install the required ansible collections needed for running the playbooks.
+
[source,bash,role=execute]
----
cd <repo>/src/ansible/
----
+
[source,bash,role=execute]
----
ansible-galaxy collection install -r requirements.yml
----

== Storage VM Deployment with Automation

You can either use the *_setup_storage.yaml_* playbook to create QCOW2 image for `storage` VM and then deploy `storage` VM on the hypervisor.

Ensure you are in *_ansible_* directory of the repo.

[source,bash,role=execute]
----
ansible-playbook playbooks/setup_storage.yaml -vvv | tee -a /tmp/setup_storage.log
----

Tha above command results in verbose play output.
`tee -a` command redirects the output to `/tmp/setup_storage.log` log file.
In case of failure, `/tmp/setup_storage.log` log file can be used for troubleshooting the issue.